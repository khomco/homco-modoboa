# This file was generated by Ansible for {{ansible_fqdn}}
# Do NOT modify this file by hand!

{% if postfix_pki is defined and postfix_pki %}
NameVirtualHost *:80
<VirtualHost *:80>
   ServerName {{modoboa_hostname}}
   Redirect permanent / https://{{modoboa_hostname}}
</VirtualHost>

{% endif %}
{% if postfix_pki is defined and postfix_pki %}
<IfModule mod_ssl.c>
{% endif %}
<VirtualHost *:{{modoboa_port}}>
ServerName {{modoboa_hostname}}
DocumentRoot {{modoboa_home}}/{{modoboa_install_name}}

{% if postfix_pki is defined and postfix_pki %}
{% set apache_tpl_tls_cert_file         = postfix_pki_path + "/" + postfix_pki_realm + "/" + postfix_pki_crt %}
{% set apache_tpl_tls_key_file          = postfix_pki_path + "/" + postfix_pki_realm + "/" + postfix_pki_key %}
SSLEngine On
SSLOptions +StrictRequire
SSLCertificateFile {{ apache_tpl_tls_cert_file }}
SSLCertificateKeyFile {{ apache_tpl_tls_key_file }}

{% endif %}
Alias /media/ {{modoboa_home}}/media/
<Directory {{modoboa_home}}/media>
  Require all granted
</Directory>

Alias /sitestatic/ {{modoboa_home}}/sitestatic/
<Directory {{modoboa_home}}/sitestatic>
  Require all granted
</Directory>

<Directory {{modoboa_home}}/{{modoboa_install_name}}>
  Require all granted
</Directory>

WSGIScriptAlias / {{modoboa_home}}/{{modoboa_install_name}}/wsgi.py
</VirtualHost>
{% if postfix_pki is defined and postfix_pki %}
</IfModule>
{% endif %}
